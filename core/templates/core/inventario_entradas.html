{% extends 'base.html' %}
{% block content %}

<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <h3 class="m-0">Inventario / Entradas</h3>

  <div class="d-flex flex-wrap gap-2">
    <!-- Formulario para subir el CSV -->
    <form class="d-flex flex-wrap gap-2" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input class="form-control form-control-sm" type="file" name="csv_file" accept=".csv" required>
      <button class="btn btn-sm btn-success" type="submit">Importar CSV</button>
    </form>

    <!-- Botón para descargar PDF -->
    <a class="btn btn-sm btn-outline-primary" href="{% url 'inventario_entradas_pdf' %}">
      Exportar PDF
    </a>
  </div>
</div>

<p class="text-muted small">
  El archivo CSV debe tener las columnas:
  <strong>producto, categoria, proveedor, cantidad, costo_unitario</strong>.
  Opcionales:
  <strong>sku, precio_venta</strong>.
</p>

<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Nombre</th>
      <th>SKU</th>
      <th>Categoría</th>
      <th>Proveedor</th>
      <th>Precio venta</th>
      <th>Stock</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for p in productos %}
      <tr class="{% if p.stock <= p.stock_minimo %}table-warning{% endif %}">
        <td>{{ forloop.counter }}</td>
        <td>{{ p.nombre }}</td>
        <td>{{ p.sku }}</td>
        <td>{{ p.categoria.nombre }}</td>
        <td>{% if p.proveedor %}{{ p.proveedor.nombre }}{% else %}-{% endif %}</td>
        <td>$ {{ p.precio_venta }}</td>
        <td>{{ p.stock }} {{ p.get_unidad_display }}</td>
        <td class="d-flex gap-1">
          <a class="btn btn-sm btn-outline-secondary" href="/productos/{{ p.id }}/editar/">Editar</a>
          <a class="btn btn-sm btn-success" href="/inventario/entrada/{{ p.id }}/">Entrada manual</a>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="8">Sin datos</td></tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}